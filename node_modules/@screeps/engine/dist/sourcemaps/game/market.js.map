{"version":3,"sources":["game/market.js"],"names":["_","require","utils","driver","getRuntimeDriver","C","constants","util","exports","make","runtimeData","intents","register","ordersCreatedDuringTick","cachedOrders","cachedHistory","_incomingTransactions","_outgoingTransactions","_orders","_getOrders","resourceType","contains","RESOURCES_ALL","INTERSHARD_RESOURCES","JSON","parse","stringify","market","orders","i","price","calcTransactionCost","wrapFn","amount","roomName1","roomName2","distance","calcRoomsDistance","calcTerminalEnergyCost","getAllOrders","filter","getHistory","history","getOrderById","id","order","all","result","createOrder","type","totalAmount","roomName","isObject","ERR_INVALID_ARGS","ORDER_BUY","ORDER_SELL","parseFloat","parseInt","MARKET_FEE","credits","ERR_NOT_ENOUGH_RESOURCES","any","userObjects","room","ERR_NOT_OWNER","size","MARKET_MAX_ORDERS","ERR_FULL","pushByName","OK","cancelOrder","orderId","deal","targetRoomName","user","resources","terminal","find","transferCost","store","RESOURCE_ENERGY","cooldownTime","time","ERR_TIRED","money","changeOrderPrice","newPrice","remainingAmount","extendOrder","addAmount","Object","defineProperties","enumerable","get","incomingTransactions","map","transactions","incoming","transactionId","_id","sender","username","users","undefined","recipient","outgoingTransactions","outgoing","myOrders","indexBy","value"],"mappings":"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","file":"../../game/market.js","sourceRoot":"/src"}
{"version":3,"sources":["processor/global-intents/market.js"],"names":["q","require","_","utils","driver","getDriver","C","constants","module","exports","orders","userIntents","usersById","gameTime","roomObjectsByType","bulkObjects","bulkUsers","bulkTransactions","bulkUsersMoney","bulkUsersResources","bulkMarketOrders","bulkMarketIntershardOrders","terminals","terminal","terminalsByRoom","indexBy","executeTransfer","fromTerminal","toTerminal","resourceType","amount","transferFeeTerminal","additionalFields","user","store","targetResourceTotal","calcResources","freeSpace","Math","max","storeCapacity","min","range","calcRoomsDistance","room","transferCost","calcTerminalEnergyCost","effect","find","effects","power","PWR_OPERATE_TERMINAL","endTime","ceil","POWER_INFO","level","RESOURCE_ENERGY","energy","update","insert","extend","time","sender","undefined","recipient","from","to","filter","i","send","forEach","intent","cooldownTime","targetRoomName","cooldown","TERMINAL_COOLDOWN","round","description","replace","ordersById","terminalDeals","directDeals","nowTimestamp","Date","getTime","iUserIntents","intents","createOrder","price","totalAmount","contains","RESOURCES_ALL","INTERSHARD_RESOURCES","roomName","fee","MARKET_FEE","money","inc","order","createdTimestamp","active","type","ORDER_SELL","ORDER_BUY","remainingAmount","bulk","created","date","tick","balance","change","market","changeOrderPrice","orderId","newPrice","oldPrice","extendOrder","addAmount","cancelOrder","_cancelled","deal","push","sort","a","b","orderTerminal","targetTerminal","buyer","seller","targetFreeSpace","dealCost","floor","id","_id","npc","owner","dealer","shuffle","resources","marketOrderId","anotherUser","remove","MARKET_ORDER_LIFE_TIME","remainingFee","toString","availableResourceAmount","userMoney","isOwner","newAmount","newActive","all","execute","clearMarketIntents"],"mappings":"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","file":"../../../processor/global-intents/market.js","sourceRoot":"/src"}
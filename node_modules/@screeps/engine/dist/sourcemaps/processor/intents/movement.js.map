{"version":3,"sources":["processor/intents/movement.js"],"names":["_","require","utils","driver","getDriver","C","constants","matrix","objects","affectedCnt","roomObjects","roomTerrain","canMove","object","type","_pulled","_oldFatigue","some","body","i","hits","MOVE","checkObstacleAtXY","x","y","roomIsInSafeMode","hasObstacle","hasRoad","forEach","_id","user","contains","OBSTACLE_OBJECT_TYPES","isPublic","structureType","checkTerrain","TERRAIN_MASK_WALL","calcResourcesWeight","creep","totalCarry","sum","store","weight","length","part","CARRY","boost","BOOSTS","capacity","Math","min","CARRY_CAPACITY","exports","init","_roomObjects","_roomTerrain","addPulling","target","checkRecursiveTarget","t","_pull","removePulling","add","dx","dy","newX","newY","key","push","isTileBusy","check","newMatrix","split","resultingMoveObject","parseInt","rates","map","moves","calcBodyEffectiveness","filter","rate1","any","rate2","rate3","rate4","sort","a","b","removeFromMatrix","execute","scope","bulk","roomController","gameTime","move","cellObjects","fatigueRate","TERRAIN_MASK_SWAMP","road","find","nextDecayTime","ROAD_WEAROUT_POWER_CREEP","ROAD_WEAROUT","update","safeMode","constructionSite","remove","progress","room","floor","fatigue","size","isAtEdge","_fatigue"],"mappings":";;;;AAAA,IAAIA,IAAIC,QAAQ,QAAR,CAAR;AAAA,IACIC,QAASD,QAAQ,aAAR,CADb;AAAA,IAEIE,SAASD,MAAME,SAAN,EAFb;AAAA,IAGIC,IAAIF,OAAOG,SAHf;AAAA,IAIIC,MAJJ;AAAA,IAKIC,OALJ;AAAA,IAMIC,WANJ;AAAA,IAOIC,WAPJ;AAAA,IAQIC,WARJ;;AAUA,SAASC,OAAT,CAAiBC,MAAjB,EAAyB;AACrB,WAAOA,OAAOC,IAAP,IAAe,YAAf,IACF,CAAC,CAACD,OAAOE,OAAT,IAAoB,CAACF,OAAOG,WAAR,IAAuBhB,EAAEiB,IAAF,CAAOJ,OAAOK,IAAd,EAAoBC,KAAKA,EAAEC,IAAF,GAAS,CAAT,IAAcD,EAAEL,IAAF,IAAUT,EAAEgB,IAAnD,CADhD;AAEH;;AAED,SAASC,iBAAT,CAA2BC,CAA3B,EAA6BC,CAA7B,EAA+BX,MAA/B,EAAuCY,gBAAvC,EAAyD;AACrD,QAAIC,cAAc,KAAlB;AAAA,QAAyBC,UAAU,KAAnC;AACA3B,MAAE4B,OAAF,CAAUlB,WAAV,EAAwBS,CAAD,IAAO;AAC1B,YAAIA,EAAEI,CAAF,IAAOA,CAAP,IAAYJ,EAAEK,CAAF,IAAOA,CAAvB,EAA0B;AACtB;AACH;AACD,YAAI,CAACL,EAAEL,IAAF,IAAU,OAAV,IAAqBK,EAAEL,IAAF,IAAU,YAAhC,KAAiD,CAACN,QAAQW,EAAEU,GAAV,CAAlD,KAAqE,CAACJ,gBAAD,IAAqBA,oBAAoBZ,OAAOiB,IAAhD,IAAwDL,oBAAoBZ,OAAOiB,IAA3B,IAAmCjB,OAAOiB,IAAP,IAAeX,EAAEW,IAAjL,KACAX,EAAEL,IAAF,IAAU,OAAV,IAAqBK,EAAEL,IAAF,IAAU,YAA/B,IAA+Cd,EAAE+B,QAAF,CAAW1B,EAAE2B,qBAAb,EAAoCb,EAAEL,IAAtC,CAD/C,IAEAK,EAAEL,IAAF,IAAU,SAAV,IAAuB,CAACK,EAAEc,QAA1B,IAAsCd,EAAEW,IAAF,IAAUjB,OAAOiB,IAFvD,IAGAX,EAAEL,IAAF,IAAU,kBAAV,IAAgCK,EAAEW,IAAF,IAAUjB,OAAOiB,IAAjD,IAAyD9B,EAAE+B,QAAF,CAAW1B,EAAE2B,qBAAb,EACrDb,EAAEe,aADmD,CAH7D,EAI0B;AACtBR,0BAAc,IAAd;AACA,mBAAO,KAAP;AACH;AACD,YAAGP,EAAEL,IAAF,IAAU,MAAb,EAAqB;AACjBa,sBAAU,IAAV;AACH;AACJ,KAfD;AAgBA,QAAGD,WAAH,EAAgB;AACZ,eAAO,IAAP;AACH;AACD,WAAOxB,MAAMiC,YAAN,CAAmBxB,WAAnB,EAAgCY,CAAhC,EAAmCC,CAAnC,EAAsCnB,EAAE+B,iBAAxC,KAA8D,CAACT,OAAtE;AAEH;;AAED,SAASU,mBAAT,CAA6BC,KAA7B,EAAoC;AAChC,QAAIC,aAAavC,EAAEwC,GAAF,CAAMF,MAAMG,KAAZ,CAAjB;AAAA,QAAqCC,SAAS,CAA9C;AACA,SAAI,IAAIvB,IAAImB,MAAMpB,IAAN,CAAWyB,MAAX,GAAkB,CAA9B,EAAiCxB,KAAK,CAAtC,EAAyCA,GAAzC,EAA8C;AAC1C,YAAG,CAACoB,UAAJ,EAAgB;AACZ;AACH;AACD,YAAIK,OAAON,MAAMpB,IAAN,CAAWC,CAAX,CAAX;AACA,YAAGyB,KAAK9B,IAAL,IAAaT,EAAEwC,KAAf,IAAwB,CAACD,KAAKxB,IAAjC,EAAuC;AACnC;AACH;AACD,YAAI0B,QAAQ,CAAZ;AACA,YAAGF,KAAKE,KAAR,EAAe;AACXA,oBAAQzC,EAAE0C,MAAF,CAAS1C,EAAEwC,KAAX,EAAkBD,KAAKE,KAAvB,EAA8BE,QAA9B,IAA0C,CAAlD;AACH;AACDT,sBAAcU,KAAKC,GAAL,CAASX,UAAT,EAAqBlC,EAAE8C,cAAF,GAAmBL,KAAxC,CAAd;AACAJ;AACH;AACD,WAAOA,MAAP;AACH;;AAEDU,QAAQC,IAAR,GAAe,UAASC,YAAT,EAAuBC,YAAvB,EAAqC;AAChDhD,aAAS,EAAT;AACAC,cAAU,EAAV;AACAC,kBAAc,EAAd;AACAC,kBAAc4C,YAAd;AACA3C,kBAAc4C,YAAd;AACH,CAND;;AAQAH,QAAQI,UAAR,GAAqB,UAAS3C,MAAT,EAAiB4C,MAAjB,EAAyB;AAC1C,UAAMC,uBAAuBC,KAAGA,EAAE9B,GAAF,IAAOhB,OAAOgB,GAAd,IAAqB,CAAC,CAAC8B,EAAEC,KAAJ,IAAa,CAAC,CAAClD,YAAYiD,EAAEC,KAAd,CAAf,IAAuCF,qBAAqBhD,YAAYiD,EAAEC,KAAd,CAArB,CAA5F;AACA,QAAG,CAACF,qBAAqBD,MAArB,CAAJ,EAAkC;AAC9B5C,eAAO+C,KAAP,GAAeH,OAAO5B,GAAtB;AACA4B,eAAO1C,OAAP,GAAiBF,OAAOgB,GAAxB;AACH;AACJ,CAND;;AAQAuB,QAAQS,aAAR,GAAwB,UAAShD,MAAT,EAAiB;AACrC,QAAGA,OAAO+C,KAAP,IAAgB,CAAC,CAAClD,YAAYG,OAAO+C,KAAnB,CAArB,EAAgD;AAC5C,eAAOlD,YAAYG,OAAO+C,KAAnB,EAA0B7C,OAAjC;AACH;AACD,WAAOF,OAAO+C,KAAd;AACH,CALD;;AAOAR,QAAQU,GAAR,GAAc,UAASjD,MAAT,EAAiBkD,EAAjB,EAAqBC,EAArB,EAAyB;AACnC,QAAIC,OAAOpD,OAAOU,CAAP,GAAWwC,EAAtB;AAAA,QACIG,OAAOrD,OAAOW,CAAP,GAAWwC,EADtB;;AAGA,QAAIC,QAAQ,EAAZ,EAAgBA,OAAO,EAAP;AAChB,QAAIC,QAAQ,EAAZ,EAAgBA,OAAO,EAAP;AAChB,QAAID,OAAO,CAAX,EAAcA,OAAO,CAAP;AACd,QAAIC,OAAO,CAAX,EAAcA,OAAO,CAAP;;AAEd,QAAIC,MAAO,GAAEF,IAAK,IAAGC,IAAK,EAA1B;AACA3D,WAAO4D,GAAP,IAAc5D,OAAO4D,GAAP,KAAe,EAA7B;AACA5D,WAAO4D,GAAP,EAAYC,IAAZ,CAAiBvD,MAAjB;;AAEAJ,gBAAY0D,GAAZ,IAAmB1D,YAAY0D,GAAZ,IAAiB,CAAjB,IAAsB,CAAzC;AACH,CAdD;;AAgBAf,QAAQiB,UAAR,GAAqB,UAAS9C,CAAT,EAAWC,CAAX,EAAc;AAC/B,WAAO,CAAC,CAACjB,OAAQ,GAAEgB,CAAE,IAAGC,CAAE,EAAjB,CAAT;AACH,CAFD;;AAIA4B,QAAQkB,KAAR,GAAgB,UAAS7C,gBAAT,EAA2B;AACvC,QAAI8C,YAAY,EAAhB;;AAEA,SAAI,IAAIpD,CAAR,IAAaZ,MAAb,EAAqB;AAAA,uBAELY,EAAEqD,KAAF,CAAQ,GAAR,CAFK;AAAA;AAAA,YAEZjD,CAFY;AAAA,YAEVC,CAFU;AAAA,YAGbiD,mBAHa;;AAKjBlD,YAAImD,SAASnD,CAAT,CAAJ;AACAC,YAAIkD,SAASlD,CAAT,CAAJ;;AAEA,YAAGjB,OAAOY,CAAP,EAAUwB,MAAV,GAAmB,CAAtB,EAAyB;AACrB,gBAAIgC,QAAQ3E,EAAE4E,GAAF,CAAMrE,OAAOY,CAAP,CAAN,EAAkBN,MAAD,IAAY;AACrC,oBAAIgE,QAAQhE,OAAOC,IAAP,IAAe,YAAf,GAA8B,CAA9B,GACJZ,MAAM4E,qBAAN,CAA4BjE,OAAOK,IAAnC,EAAyCb,EAAEgB,IAA3C,EAAiD,SAAjD,EAA4D,CAA5D,CADR;AAAA,oBAEIqB,SAAS7B,OAAOC,IAAP,IAAe,YAAf,GAA8B,CAA9B,GACLd,EAAE+E,MAAF,CAASlE,OAAOK,IAAhB,EAAuBC,CAAD,IAAOA,EAAEL,IAAF,IAAUT,EAAEgB,IAAZ,IAAoBF,EAAEL,IAAF,IAAUT,EAAEwC,KAA7D,EAAoEF,MAH5E;AAIAD,0BAAU7B,OAAOC,IAAP,IAAe,YAAf,GAA8B,CAA9B,GACNuB,oBAAoBxB,MAApB,CADJ;AAEA6B,yBAASA,UAAU,CAAnB;AACA,oBAAIyB,MAAO,GAAEtD,OAAOU,CAAE,IAAGV,OAAOW,CAAE,EAAlC;AAAA,oBACIwD,QAAQvE,YAAY0D,GAAZ,KAAoB,CADhC;AAEA,oBAAG5D,OAAO4D,GAAP,KAAenE,EAAEiF,GAAF,CAAM1E,OAAO4D,GAAP,CAAN,EAAmB,EAAC5C,CAAD,EAAGC,CAAH,EAAnB,CAAlB,EAA6C;AACzCwD,4BAAQ,GAAR;AACH;;AAED,uBAAO;AACHnE,0BADG;AAEHmE,yBAFG;AAGHE,2BAAO,CAAC,CAACrE,OAAOE,OAAT,GAAiB,CAAjB,GAAmB,CAHvB;AAIHoE,2BAAO,CAAC,CAACtE,OAAO+C,KAAT,GAAe,CAAf,GAAiB,CAJrB;AAKHwB,2BAAOP,QAAQnC;AALZ,iBAAP;AAOH,aArBW,CAAZ;;AAuBAiC,kBAAMU,IAAN,CAAW,CAACC,CAAD,EAAGC,CAAH,KAASA,EAAEP,KAAF,GAAUM,EAAEN,KAAZ,IAAqBO,EAAEL,KAAF,GAAUI,EAAEJ,KAAjC,IAA0CK,EAAEJ,KAAF,GAAUG,EAAEH,KAAtD,IAA+DI,EAAEH,KAAF,GAAUE,EAAEF,KAA/F;;AAEAX,kCAAsBE,MAAM,CAAN,EAAS9D,MAA/B;AACH,SA3BD,MA4BK;AACD4D,kCAAsBlE,OAAOY,CAAP,EAAU,CAAV,CAAtB;AACH;;AAEDX,gBAAQiE,oBAAoB5C,GAA5B,IAAmC,EAACN,CAAD,EAAGC,CAAH,EAAnC;;AAEA+C,kBAAUpD,CAAV,IAAesD,mBAAf;AACH;;AAEDlE,aAASgE,SAAT;;AAEA,aAASiB,gBAAT,CAA0BrE,CAA1B,EAA6B;AACzB,YAAIN,SAASN,OAAOY,CAAP,CAAb;AACAX,gBAAQD,OAAOY,CAAP,EAAUU,GAAlB,IAAyB,IAAzB;AACA,eAAOtB,OAAOY,CAAP,CAAP;;AAEA,YAAGN,MAAH,EAAW;AACP,gBAAIsD,MAAO,GAAEtD,OAAOU,CAAE,IAAGV,OAAOW,CAAE,EAAlC;AACA,gBAAGjB,OAAO4D,GAAP,CAAH,EAAgB;AACZqB,iCAAiBrB,GAAjB;AACH;AACJ;AACJ;;AAED,SAAI,IAAIhD,CAAR,IAAaZ,MAAb,EAAqB;AAAA,wBAELY,EAAEqD,KAAF,CAAQ,GAAR,CAFK;AAAA;AAAA,YAEZjD,CAFY;AAAA,YAEVC,CAFU;;AAIjBD,YAAImD,SAASnD,CAAT,CAAJ;AACAC,YAAIkD,SAASlD,CAAT,CAAJ;;AAEA,YAAIX,SAASN,OAAOY,CAAP,CAAb;;AAEA,YAAG,CAAC,CAACN,OAAOE,OAAT,IAAoB,CAAC,CAACL,YAAYG,OAAOE,OAAnB,CAAzB,EAAsD;AAClD,gBAAGL,YAAYG,OAAOE,OAAnB,EAA4B6C,KAA5B,IAAqC/C,OAAOgB,GAA5C,IAAmDV,KAAM,GAAET,YAAYG,OAAOE,OAAnB,EAA4BQ,CAAE,IAAGb,YAAYG,OAAOE,OAAnB,EAA4BS,CAAE,EAA7H,EAAgI;AAC5H,uBAAOd,YAAYG,OAAOE,OAAnB,EAA4B6C,KAAnC;AACA,uBAAO/C,OAAOE,OAAd;AACH;AACJ;;AAED,YAAG,CAACH,QAAQC,MAAR,CAAD,IAAoB,CAAC,CAACS,kBAAkBC,CAAlB,EAAoBC,CAApB,EAAuBX,MAAvB,EAA+BY,gBAA/B,CAAzB,EAA2E;AACvE+D,6BAAiBrE,CAAjB;AACH;AACJ;AACJ,CAnFD;;AAqFAiC,QAAQqC,OAAR,GAAkB,UAAS5E,MAAT,EAAiB6E,KAAjB,EAAwB;AAAA,UAE/BC,IAF+B,GAEGD,KAFH,CAE/BC,IAF+B;AAAA,UAEzBC,cAFyB,GAEGF,KAFH,CAEzBE,cAFyB;AAAA,UAETC,QAFS,GAEGH,KAFH,CAETG,QAFS;;;AAItC,QAAIC,OAAOtF,QAAQK,OAAOgB,GAAf,CAAX;AACA,QAAG,CAACiE,IAAJ,EAAU;AACN;AACH;;AAED,QAAG,CAAClF,QAAQC,MAAR,CAAJ,EAAqB;AACjB;AACH;;AAED,QAAIkF,cAAc/F,EAAE+E,MAAF,CAASrE,WAAT,EAAuBS,CAAD,IAAOA,EAAEI,CAAF,IAAOuE,KAAKvE,CAAZ,IAAiBJ,EAAEK,CAAF,IAAOsE,KAAKtE,CAA1D,CAAlB;;AAEA,QAAIwE,cAAc,CAAlB;;AAEA,QAAGhG,EAAEiF,GAAF,CAAMc,WAAN,EAAmB,EAACjF,MAAM,OAAP,EAAnB,KACCZ,MAAMiC,YAAN,CAAmBxB,WAAnB,EAAgCmF,KAAKvE,CAArC,EAAwCuE,KAAKtE,CAA7C,EAAgDnB,EAAE4F,kBAAlD,CADJ,EAC2E;AACvED,sBAAc,EAAd;AACH;;AAED,QAAIE,OAAOlG,EAAEmG,IAAF,CAAOJ,WAAP,EAAoB,EAACjF,MAAM,MAAP,EAApB,CAAX;;AAEA,QAAGoF,IAAH,EAAS;AACLF,sBAAc,CAAd;AACA,YAAGnF,OAAOC,IAAP,IAAe,YAAlB,EAAgC;AAC5BoF,iBAAKE,aAAL,IAAsB/F,EAAEgG,wBAAxB;AACH,SAFD,MAGK;AACDH,iBAAKE,aAAL,IAAsB/F,EAAEiG,YAAF,GAAiBzF,OAAOK,IAAP,CAAYyB,MAAnD;AACH;AACDgD,aAAKY,MAAL,CAAYL,IAAZ,EAAkB,EAACE,eAAeF,KAAKE,aAArB,EAAlB;AACH;;AAED,QAAG,CAACR,cAAD,IAAmBA,eAAe9D,IAAf,KAAwBjB,OAAOiB,IAAlD,IAA0D,EAAE8D,eAAeY,QAAf,GAA0BX,QAA5B,CAA7D,EAAoG;AAChG,YAAIY,mBAAmBzG,EAAEmG,IAAF,CAAOJ,WAAP,EAAqB5E,CAAD,IAAOA,EAAEL,IAAF,IAAU,kBAAV,IAAgCK,EAAEW,IAAF,IAAUjB,OAAOiB,IAA5E,CAAvB;AACA,YAAI2E,gBAAJ,EAAsB;AAClBd,iBAAKe,MAAL,CAAYD,iBAAiB5E,GAA7B;AACA,gBAAG4E,iBAAiBE,QAAjB,GAA4B,CAA/B,EAAkC;AAC9B1G,wBAAQ,kBAAR,EAA4BwG,iBAAiBlF,CAA7C,EAAgDkF,iBAAiBjF,CAAjE,EACIiF,iBAAiBG,IADrB,EAC2B3D,KAAK4D,KAAL,CAAWJ,iBAAiBE,QAAjB,GAA0B,CAArC,CAD3B,EACoE,QADpE,EAC8EjB,KAD9E;AAEH;AACJ;AACJ;;AAED,QAAIoB,OAAJ;AACA,QAAGjG,OAAOC,IAAP,IAAe,OAAlB,EAA2B;AACvBgG,kBAAU9G,EAAEa,OAAOK,IAAT,EAAe6D,MAAf,CAAuB5D,CAAD,IAAOA,EAAEL,IAAF,IAAUT,EAAEgB,IAAZ,IAAoBF,EAAEL,IAAF,IAAUT,EAAEwC,KAA7D,EAAoEkE,IAApE,EAAV;AACAD,mBAAWzE,oBAAoBxB,MAApB,CAAX;AACAiG,mBAAWd,WAAX;AACH;;AAED,QAAG9F,MAAM8G,QAAN,CAAelB,IAAf,KAAwB,CAAC5F,MAAM8G,QAAN,CAAenG,MAAf,CAA5B,EAAoD;AAChDiG,kBAAU,CAAV;AACAjG,eAAOoG,QAAP,GAAkB,CAAlB;AACAtB,aAAKY,MAAL,CAAY1F,MAAZ,EAAoB,EAAEU,GAAGuE,KAAKvE,CAAV,EAAaC,GAAGsE,KAAKtE,CAArB,EAAwBsF,OAAxB,EAApB;AACH,KAJD,MAIO;AACHnB,aAAKY,MAAL,CAAY1F,MAAZ,EAAoB,EAAEU,GAAGuE,KAAKvE,CAAV,EAAaC,GAAGsE,KAAKtE,CAArB,EAApB;AACA,YAAGX,OAAOC,IAAP,IAAe,OAAlB,EAA2B;AACvBb,oBAAQ,uBAAR,EAAiCY,MAAjC,EAAyCiG,OAAzC,EAAkDpB,KAAlD;AACH;AACJ;AACJ,CA/DD","file":"../../../processor/intents/movement.js","sourceRoot":"/src"}
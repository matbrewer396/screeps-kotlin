{"version":3,"sources":["processor/intents/creeps/upgradeController.js"],"names":["_","require","utils","driver","getDriver","C","constants","config","module","exports","object","intent","roomObjects","bulk","bulkUsers","stats","gameTime","eventLog","type","spawning","store","energy","target","id","Math","abs","x","y","level","user","upgradeBlocked","_upgraded","buildPower","filter","body","i","hits","_oldHits","WORK","length","UPGRADE_CONTROLLER_POWER","buildEffect","min","boostedParts","map","boost","BOOSTS","upgradeController","limit","CONTROLLER_MAX_UPGRADE_PER_TICK","effect","find","effects","power","PWR_OPERATE_CONTROLLER","endTime","POWER_INFO","sort","a","b","slice","boostedEffect","floor","sum","nextLevelProgress","CONTROLLER_LEVELS","ptr","tutorial","progress","downgradeTime","CONTROLLER_DOWNGRADE_RESTORE","CONTROLLER_DOWNGRADE","sendNotification","room","safeModeAvailable","inc","actionLog","update","push","event","EVENT_UPGRADE_CONTROLLER","objectId","_id","data","amount","energySpent"],"mappings":"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","file":"../../../../processor/intents/creeps/upgradeController.js","sourceRoot":"/src"}